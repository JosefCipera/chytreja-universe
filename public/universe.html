<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chytr√© J√° ‚Äì Universe</title>

    <!-- CSS -->
    <link rel="stylesheet" href="./assets/css/universe.css" />

    <!-- vis-network (jen jeden CDN) -->
    <script src="https://unpkg.com/vis-network@9.1.9/dist/vis-network.min.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/vis-network@9.1.9/styles/vis-network.min.css" />

</head>

<body>
    <!-- Horn√≠ li≈°ta -->
    <div class="app-header">
        <h1 id="appTitle">Chytr√© J√°</h1>
        <select id="modelSelector" class="model-selector">
            <option value="dlouhovekost" selected>Dlouhovƒõkost</option>
            <option value="toc">TOC ‚Äì Teorie omezen√≠</option>
        </select>
    </div>

    <!-- Pl√°tno s√≠tƒõ -->
    <div id="network"></div>

    <!-- Postrann√≠ panel -->
    <aside id="sidePanel">
        <div class="panel-header">
            <h2 id="nodeTitle">‚Äî</h2>
            <button class="panel-close" id="closePanel" title="Zav≈ô√≠t">‚úñ</button>
        </div>
        <div class="panel-content">
            <p class="definition" id="nodeDef"></p>

            <hr>
            <h3>üìÑ Dokumenty</h3>
            <ul id="nodeDocs"></ul>

            <hr>
            <h3>üé¨ M√©dia</h3>
            <ul id="nodeMedia"></ul>

            <hr>
            <h3>‚úÖ √ölohy</h3>
            <ul id="nodeTasks"></ul>
        </div>

        <!-- === AI HELPER (inside #sidePanel) === -->
        <div id="aiHelper" class="ai-helper mini">
            <div class="aih-mini">
                <div class="aih-title">üß† Chytr√© J√°</div>
                <div class="aih-mini-input">
                    <input id="aihInputMini" type="text" placeholder="Zeptej se na cokoliv‚Ä¶" />
                    <span class="aih-mini-mic" title="Mluv üéôÔ∏è">üéôÔ∏è</span>
                </div>
            </div>

            <div class="aih-body">
                <div class="aih-header">
                    <div>üß† Chytr√© J√° ‚Äì Chat</div>
                    <button id="aihClose">‚úñ</button>
                </div>

                <div id="aihWindow" class="aih-window"></div>

                <div class="aih-input">
                    <input id="aihInput" type="text" placeholder="Zadej dotaz nebo mluv üéôÔ∏è‚Ä¶" />
                    <button id="aihMic" title="Hlasov√Ω vstup">üéôÔ∏è</button>
                    <button id="aihSend">‚û§</button>
                </div>
            </div>
        </div>


        <script>
            (() => {
                const cfg = {
                    welcome: "Ahoj üëã Jsem Chytr√© J√°. Zeptej se na cokoliv.",
                    replies: [
                        "Zat√≠m si jen tr√©nuji pamƒõ≈• üòä",
                        "Zkus to ≈ô√≠ct jinak?",
                        "Zaj√≠mav√° ot√°zka ‚Äì p≈ôem√Ω≈°l√≠m ‚Ä¶"
                    ]
                };

                const el = id => document.getElementById(id);
                const helper = el("aiHelper"),
                    miniInput = el("aihInputMini"),
                    win = el("aihWindow"),
                    inp = el("aihInput"),
                    send = el("aihSend"),
                    close = el("aihClose");

                const append = (txt, who = "ai") => {
                    const d = document.createElement("div");
                    d.className = `aih-msg ${who}`;
                    d.textContent = txt;
                    win.appendChild(d);
                    win.scrollTop = win.scrollHeight;
                };

                const reply = (t) => {
                    const q = t.toLowerCase();
                    if (q.includes("vo2max")) return "VO‚ÇÇmax zlep≈°√≠≈° Zone 2 a obƒças sprint. üö¥";
                    if (q.includes("sp√°nek")) return "Veƒçer m√©nƒõ modr√©ho svƒõtla a chladnƒõji. üò¥";
                    const i = Math.floor(Math.random() * cfg.replies.length);
                    return cfg.replies[i];
                };

                const sendMsg = (t) => {
                    if (!t.trim()) return;
                    append(t, "user");
                    setTimeout(() => append(reply(t), "ai"), 400);
                };

                // mini input ‚Üí expand
                miniInput.addEventListener("focus", () => {
                    helper.classList.remove("mini"); helper.classList.add("expanded");
                    inp.focus();
                });

                inp.addEventListener("keydown", e => {
                    if (e.key === "Enter") sendMsg(inp.value), inp.value = "";
                });
                send.addEventListener("click", () => { sendMsg(inp.value); inp.value = ""; });
                close.addEventListener("click", () => {
                    helper.classList.remove("expanded"); helper.classList.add("mini");
                    win.innerHTML = "";
                });

                append(cfg.welcome, "ai");
            })();
        </script>

        <script>
            (() => {
                const sidePanel = document.getElementById("sidePanel");
                const aiHelper = document.getElementById("aiHelper");
                const aiInputMini = document.getElementById("aihInputMini");
                const aiClose = document.getElementById("aihClose");

                // üü¢ Aktivace chatu (p≈ôi psan√≠ nebo mluven√≠)
                aiInputMini.addEventListener("focus", () => {
                    sidePanel.classList.add("chat-active");
                    aiHelper.classList.remove("mini");
                    aiHelper.classList.add("expanded");
                });

                // üî¥ Zav≈ôen√≠ chatu
                aiClose.addEventListener("click", () => {
                    sidePanel.classList.remove("chat-active");
                    aiHelper.classList.remove("expanded");
                    aiHelper.classList.add("mini");
                });
            })();
        </script>

    </aside>

    <!-- Overlay pro dokumenty (MD/PDF) -->
    <div id="docOverlay">
        <div id="docViewer">
            <button id="closeDoc" title="Zav≈ô√≠t">‚úñ</button>
            <iframe id="docFrame" src=""></iframe>
        </div>
    </div>

    <!-- Init (ESM) -->
    <script type="module" src="./assets/js/universe-init.js"></script>
</body>

</html>