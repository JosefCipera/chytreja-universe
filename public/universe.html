<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Vesmír Desktop 🌌</title>

    <!-- 📦 Knihovny -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- 🎨 Styl -->
    <link rel="stylesheet" href="./assets/css/universe.css">
</head>

<body>
    <!-- 🧭 Horní lišta -->
    <div class="app-header">
        <h1 id="appTitle">Chytré Já</h1>
        <select id="modelSelector" class="model-selector">
            <option value="dlouhovekost" selected>Dlouhověkost</option>
            <option value="toc">TOC – Teorie omezení</option>
        </select>
    </div>

    <!-- 🌌 Plátno sítě -->
    <div id="network"></div>

    <!-- === 🌌 Postranní panel s helperem === -->
    <aside id="sidePanel">
        <div class="panel-header">
            <h2 id="nodeTitle">Uzlový název</h2>
            <button class="panel-close" id="closePanel">✖</button>
        </div>

        <div class="panel-content">
            <p class="definition" id="nodeDef"></p>

            <hr>
            <h3>💬 Myšlenky</h3>
            <ul id="nodeThoughts"></ul>

            <hr>
            <h3>📘 Dokumenty</h3>
            <ul id="nodeDocs"></ul>

            <hr>
            <h3>🎬 Média</h3>
            <ul id="nodeMedia"></ul>

            <hr>
            <h3>🧩 Úlohy</h3>
            <ul id="nodeTasks"></ul>
        </div>

        <!-- 🧠 AI Helper -->
        <div id="aiHelper" class="mini">
            <div class="aih-header">
                <span>🧠 Chytré Já</span>
                <button id="aihClose">✖</button>
            </div>

            <div class="aih-body">
                <div id="aihMessages" class="aih-messages"></div>
                <div class="aih-input">
                    <button id="aihMic"><i class="fa-solid fa-microphone"></i></button>
                    <input id="aihInput" type="text" placeholder="Zeptej se na cokoliv…" />
                    <button id="aihSend"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </div>
        </div>
    </aside>

    <!-- === 📄 Overlay pro dokumenty (MD/PDF) === -->
    <div id="docOverlay">
        <div id="docViewer">
            <button id="closeDoc" title="Zavřít">✖</button>
            <iframe id="docFrame" src=""></iframe>
        </div>
    </div>

    <!-- 🤖 AI Helper logika -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const helper = document.getElementById("aiHelper");
            const header = helper.querySelector(".aih-header");
            const input = document.getElementById("aihInput");
            const sendBtn = document.getElementById("aihSend");
            const micBtn = document.getElementById("aihMic");
            const messages = document.getElementById("aihMessages");
            const close = document.getElementById("aihClose");

            // 🗨️ Přidání zprávy
            const append = (text, who = "ai") => {
                const div = document.createElement("div");
                div.className = `msg ${who}`;
                div.textContent = text;
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
            };

            // 💬 Odpovědi helperu
            const reply = t => {
                const q = t.toLowerCase();
                if (q.includes("spánek")) return "Spánek je základ – 7–8 hodin a tma.";
                if (q.includes("výroba")) return "Najdi úzké místo a zesil tok. ⚙️";
                if (q.includes("ahoj")) return "Ahoj 👋, jsem Chytré Já. Jak ti mohu pomoct?";
                return "Zajímavé, pověz mi víc… 🤔";
            };

            // 🚀 Odeslání zprávy
            const send = () => {
                const text = input.value.trim();
                if (!text) return;
                append(text, "user");
                input.value = "";
                setTimeout(() => append(reply(text), "ai"), 400);
            };

            // 🔄 Přepínání režimů helperu
            header.addEventListener("click", () => helper.classList.toggle("mini"));
            close.addEventListener("click", e => {
                e.stopPropagation();
                helper.classList.add("mini");
            });

            sendBtn.addEventListener("click", send);
            input.addEventListener("keydown", e => { if (e.key === "Enter") send(); });

            // 🎙️ Mikrofon – placeholder
            micBtn.addEventListener("click", () => append("🎤 Záznam hlasu zatím není aktivní.", "ai"));

            // 🧠 Úvodní zpráva
            append("Ahoj 👋 jsem Chytré Já. Ptej se na cokoliv.", "ai");
        });
    </script>

    <!-- 🚀 Inicializace vesmíru -->
    <script type="module" src="./assets/js/universe-init.js"></script>
</body>

</html>