<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>Vesm√≠r Desktop üåå</title>

    <!-- üì¶ Knihovny -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.css">
    <script src="https://cdn.jsdelivr.net/npm/vis-network@9.1.9/dist/vis-network.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <!-- üé® Styl -->
    <link rel="stylesheet" href="./assets/css/universe.css">
</head>

<body>
    <!-- üß≠ Horn√≠ li≈°ta -->
    <div class="app-header">
        <h1 id="appTitle">Chytr√© J√°</h1>
        <select id="modelSelector" class="model-selector">
            <option value="dlouhovekost" selected>Dlouhovƒõkost</option>
            <option value="toc">TOC ‚Äì Teorie omezen√≠</option>
        </select>
    </div>

    <!-- üåå Pl√°tno s√≠tƒõ -->
    <div id="network"></div>

    <!-- === üåå Postrann√≠ panel === -->
    <aside id="sidePanel">
        <div class="panel-header">
            <h2 id="nodeTitle"><i class="fa-solid fa-circle-nodes"></i> Uzlov√Ω n√°zev</h2>
            <button class="panel-close" id="closePanel">‚úñ</button>
        </div>

        <div class="panel-content">
            <p class="definition" id="nodeDef"></p>

            <hr>
            <h3>üí¨ My≈°lenky</h3>
            <ul id="nodeThoughts"></ul>

            <hr>
            <h3>üìò Dokumenty</h3>
            <ul id="nodeDocs"></ul>

            <hr>
            <h3>üé¨ M√©dia</h3>
            <ul id="nodeMedia"></ul>

            <hr>
            <h3>üß© √ölohy</h3>
            <ul id="nodeTasks"></ul>

            <!-- === üß† Chytr√© j√° ‚Äì sekce v panelu === -->
            <hr class="ai-divider">
            <h3 class="ai-section-title"><i class="fa-solid fa-brain"></i> Chytr√© j√°</h3>
            <div id="aiPanelSection">
                <input id="aiPanelInput" type="text" placeholder="Zeptej se Chytr√©ho j√°‚Ä¶" />
                <button id="aiPanelSend"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>

        <!-- === üß† Rozbalen√Ω chat === -->
        <div id="aiChatOverlay" class="hidden">
            <div class="ai-chat-header">
                <h2><i class="fa-solid fa-brain"></i> Chytr√© j√°</h2>
                <button id="aiChatClose">‚úñ</button>
            </div>
            <div id="aiChatMessages"></div>
            <div class="ai-chat-input">
                <input id="aiChatInput" type="text" placeholder="Zeptej se..." />
                <button id="aiChatSend"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </aside>

    <!-- === üìÑ Overlay pro dokumenty (MD/PDF) === -->
    <div id="docOverlay">
        <div id="docViewer">
            <button id="closeDoc" title="Zav≈ô√≠t">‚úñ</button>
            <iframe id="docFrame" src=""></iframe>
        </div>
    </div>

    <!-- ü§ñ Logika Chytr√©ho j√° -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            /* === üß† Chytr√© j√° ‚Äì z√°kladn√≠ prvky === */
            const panelInput = document.getElementById("aiPanelInput");
            const panelSend = document.getElementById("aiPanelSend");
            const chatOverlay = document.getElementById("aiChatOverlay");
            const chatMessages = document.getElementById("aiChatMessages");
            const chatInput = document.getElementById("aiChatInput");
            const chatSend = document.getElementById("aiChatSend");
            const chatClose = document.getElementById("aiChatClose");

            /* === üí¨ Pomocn√© funkce === */
            const appendMsg = (text, who = "ai") => {
                const div = document.createElement("div");
                div.className = `msg ${who}`;
                div.textContent = text;
                chatMessages.appendChild(div);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            };

            const aiReply = (text) => {
                const q = text.toLowerCase();
                if (q.includes("sp√°nek")) return "Sp√°nek je z√°klad ‚Äì 7‚Äì8 hodin a tma.";
                if (q.includes("v√Ωroba")) return "Najdi √∫zk√© m√≠sto a zesil tok. ‚öôÔ∏è";
                if (q.includes("ahoj")) return "Ahoj üëã, jsem Chytr√© j√°. Jak ti mohu pomoct?";
                return "Zaj√≠mav√©, povƒõz mi v√≠c‚Ä¶ ü§î";
            };

            /* === üöÄ Rozbalen√≠ chatu === */
            const openChat = (text) => {
                if (!text) return;

                // üé¨ Zobraz overlay p≈ôes cel√Ω panel
                chatOverlay.classList.add("visible");
                chatOverlay.style.opacity = "1";
                chatOverlay.style.pointerEvents = "all";
                chatOverlay.style.transform = "translateY(0)";

                // üßπ Vyƒçisti a p≈ôidej zpr√°vy
                chatMessages.innerHTML = "";
                appendMsg(text, "user");
                panelInput.value = "";
                setTimeout(() => appendMsg(aiReply(text), "ai"), 600);

                console.log("üß† Chytr√© j√° rozbaleno.");
            };

            /* === ‚ùé Zav≈ôen√≠ chatu === */
            chatClose.addEventListener("click", () => {
                chatOverlay.classList.remove("visible");
                chatOverlay.style.opacity = "0";
                chatOverlay.style.pointerEvents = "none";
                chatOverlay.style.transform = "translateY(20px)";
                console.log("‚ùé Chytr√© j√° skryto.");
            });

            /* === üì© Odesl√°n√≠ dotazu ze sekce dole === */
            panelSend.addEventListener("click", () => {
                openChat(panelInput.value.trim());
            });

            panelInput.addEventListener("keydown", (e) => {
                if (e.key === "Enter") openChat(panelInput.value.trim());
            });

            /* === üí¨ Odesl√°n√≠ p≈ô√≠mo z rozbalen√©ho chatu === */
            const sendChatMsg = () => {
                const text = chatInput.value.trim();
                if (!text) return;
                appendMsg(text, "user");
                chatInput.value = "";
                setTimeout(() => appendMsg(aiReply(text), "ai"), 600);
            };

            chatSend.addEventListener("click", sendChatMsg);
            chatInput.addEventListener("keydown", (e) => {
                if (e.key === "Enter") sendChatMsg();
            });

            console.log("‚úÖ Chytr√© j√° inicializov√°no.");
        });
    </script>
    <!-- === üß† PLovouc√≠ Chytr√© J√° === -->
    <div id="floatingAiHelper" class="ai-helper mini hidden">
        <div class="aih-header">
            <span>üß† Chytr√© j√°</span>
            <button id="aihClose">‚úñ</button>
        </div>

        <div class="aih-mini">
            <div class="aih-mini-title">üß† Chytr√© j√°</div>
            <div class="aih-mini-input">
                <input id="aihMiniInput" type="text" placeholder="Zeptej se‚Ä¶" />
                <button id="aihMiniMic"><i class="fa-solid fa-microphone"></i></button>
            </div>
        </div>

        <div class="aih-body">
            <div id="aihMessages" class="aih-window"></div>
            <div class="aih-input">
                <button id="aihMic"><i class="fa-solid fa-microphone"></i></button>
                <input id="aihInput" type="text" placeholder="Zeptej se na cokoliv‚Ä¶" />
                <button id="aihSend"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const helper = document.getElementById("floatingAiHelper");
            const header = helper.querySelector(".aih-header");
            const messages = document.getElementById("aihMessages");
            const input = document.getElementById("aihInput");
            const sendBtn = document.getElementById("aihSend");
            const micBtn = document.getElementById("aihMic");
            const miniInput = document.getElementById("aihMiniInput");
            const miniMic = document.getElementById("aihMiniMic");
            const closeBtn = document.getElementById("aihClose");

            // === P≈ôid√°n√≠ zpr√°vy ===
            const appendMsg = (text, who = "ai") => {
                const div = document.createElement("div");
                div.className = `aih-msg ${who}`;
                div.textContent = text;
                messages.appendChild(div);
                messages.scrollTop = messages.scrollHeight;
            };

            // === Odpovƒõƒè AI ===
            const aiReply = (text) => {
                const q = text.toLowerCase();
                if (q.includes("sp√°nek")) return "Sp√°nek je z√°klad ‚Äì 7‚Äì8 hodin a tma.";
                if (q.includes("v√Ωroba")) return "Najdi √∫zk√© m√≠sto a zesil tok. ‚öôÔ∏è";
                if (q.includes("ahoj")) return "Ahoj üëã, jsem Chytr√© j√°. Jak ti mohu pomoci?";
                return "Zaj√≠mav√©, povƒõz mi v√≠c‚Ä¶ ü§î";
            };

            // === Odesl√°n√≠ ===
            const send = (text) => {
                if (!text.trim()) return;
                appendMsg(text, "user");
                input.value = "";
                setTimeout(() => appendMsg(aiReply(text), "ai"), 500);
            };

            sendBtn.addEventListener("click", () => send(input.value));
            input.addEventListener("keydown", (e) => e.key === "Enter" && send(input.value));

            // === Mini re≈æim ===
            miniInput.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                    helper.classList.remove("mini");
                    helper.classList.add("expanded");
                    send(miniInput.value);
                    miniInput.value = "";
                }
            });

            // === Zav≈ôen√≠ ===
            closeBtn.addEventListener("click", () => {
                helper.classList.add("hidden");
                helper.classList.remove("expanded");
                helper.classList.add("mini");
            });

            // === P≈ôep√≠n√°n√≠ mezi mini/expanded ===
            header.addEventListener("click", () => {
                helper.classList.toggle("expanded");
                helper.classList.toggle("mini");
            });

            // === Otev≈ôen√≠ z k√≥du ===
            window.openAiChat = () => {
                helper.classList.remove("hidden");
                helper.classList.add("mini");
            };

            console.log("‚úÖ Plovouc√≠ Chytr√© j√° inicializov√°no.");
        });
    </script>

    <!-- üöÄ Inicializace vesm√≠ru -->
    <script type="module" src="./assets/js/universe-init.js"></script>
</body>

</html>